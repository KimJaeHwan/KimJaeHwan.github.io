---
layout: single
title: "컴퓨터 네트워크"
---

# 데이터 링크 계층

------

- 오류제어 , 흐름제어의 원리와 동작 방식
- 통신 프로토콜에서 윈도우의 개념과 동작 방식
- 양방향 통신을 지원하는 슬라이딩 윈도우 프로토콜
- HDLC 프로토콜을 통해 프로토콜을 구현하는 원리 이해

------

## 데이터 링크 계층 프로토콜

- 데이터링크 계층은 직접 물리적으로 연결된 두 호스트 간의 신뢰성 있는 데이터 전송을 지원
- 데이터 링크 계층에서 두 호스트가 통신을 하려면 두 호스트는 직접 연결되어 있어야한다.
- 점대점(point to point)연결 방식
  - 두개의 호스트가 직접 연결된 방식으로, 두호스트만 서로 연결된 형태
  - 주소 개념 불필요
- 멀티 드롭 연결 방식(버스 구조)
  - 하나의 호스트가 다수의 호스트와 연결된 비대칭 형태
  - 하나의 물리 매체를 여러 호스트가 공유하는 형태로, 임의의 호스트가 전송한 프레임은 직접 연결되어 있는 모든 호스트에게 전달된다.
  - 목적지를 지정하기 위해 주소 개념 필요
- 오류 복구 기능 수행
  - 데이터 전송 과정에서 물리적인 전송 오류가 발생할 수 있음
  - 물리적인 오류를 복구하는 것은 데이터 링크 계층의 기본 역할 => 신뢰성 있는 데이터 전송 보장
  - 오류 제어 방식으로 <b>재전송 기법</b>을 사용

------

## 01_데이터 링크 계층 프로토콜의 기초

- ### 프레임의 종류

  - 데이터 링크 계층에서 사용하는 프레임의 종류 세 가지
  - 정보 프레임( I 프레임 )
    - 상위 계층이 전송을 요청한 데이터를 수신호스트에 전송하는 용도로 사용
    - 상위 계층이 보낸 데이터 + 순서번호 + 송수신 호스트 정보 들이 포함됨
      - <small>순서번호: 각 정보 프레임에 부여되는 고유의 번호로, 수신 호스트가 중복 프레임을 구분하는데 사용</small>
  - 긍정응답 프레임( ACK프레임 )
    - 전송 데이터가 올바르게 도착했음을 회신하는 용도
    - 데이터를 수신한 호스트가 데이터를 송신한 호스트에게 전송
    - 순서번호가 포힘되어 전송되며, 이를 통해 몇 번 프레임이 ACK되었는지를 확인
  - 부정 응답 프레임(NAK 프레임)
    - 전송 과정에서 프레임 변형 오류가 발생했음을 회신하는 용도 (데이털르 받았는데 오류가 있는 경우)
    - 원래의 정보 프레임을 재전송하도록 요청
    - 송신 호스트는 오류가 발생한 프레임을 동일한 순서 번호로 다시 전송
    - 순서번호가 포함되어 전송되며, 이를 통해 몇 번 프레임이 NAK되었는지 확인

- ### 데이터 링크 계층의 전송 프로토콜

  - 정보 프레임(I), 긍정 응답 프레임(ACK) , 부정 응답 프레임(NAK)를 사용해서 데이터 링크 계층의 전송 프로토콜을 설계 할 수 있음
  - 프로토콜 설계시, 주로 다루는 내용은 오류 제어, 흐름제어, 전송방식(양방향/단방향) 등이다
    - 오류제어 : 전송오류 발생시 오류 복구
    - 흐름제어 : 데이터 프레임의 전송 속도를 조절하는것
    - 전송방식 :
      - <small>단방향 통신: 하나의 호스트는 송신 호스트 또는 수신 호스트중 하나의 역할을 담당하고, 데이터(정보 프레임)는 송신 호스트에서 수신 호스트로만 전달됨</small>
      - <small>양방향 통신: 송신 호스트와 수신 호스트의 구분없이 양방향으로 동시에 정보 프레임과 응답 프레임을 교차하여 전송할 수 있음(참고 : 슬라이딩 윈도우 프로토콜)</small>

- ### 오류제어, 흐름 제어가 없는 프로토콜

  - 가정 : 이상적인 통신환경

    - 단방향 통신 : 데이터는 송신 호스트에서 수신 호스트로만 전달

    - 전송 오류 없는 물리 매체 : 통신 채널에서 전송 오류가 발생하지 않음

    - 무한개의 수신 버퍼 : 수신 호스트의 버퍼 용량에 제한이 없음

      

  - 단순 프로토콜

    - 송신 호스트는 원하느 ㄴ만큼 자유롭게 프레임을 전송할 수 있음
    - 오류제어 : 필요없음
      - <small>프레임 분실/변형 오류가 발생하지않음</small>
      - <small>수신 호스트로부터 전송 성공 여부에 대한 결과를 회신받을 필요없음</small>
    - 흐름제어 : 필요 없음
      - <small> 수신 버퍼가 무한이므로 송수신 호스트 사이의 속도 차이로 인해 프레임을 분실할 염려가 없음</small>
      - <small>상위 계층에서 전송 요청이 발생하면 즉시 전송</small>

- ### 오류제어가 없는 프로토콜 (흐름 제어 있음)

  - 가정:
    - <b>수신호스트의 버퍼 개수가 유한함(버퍼 개수 제한)</b>
    - 단방향 통신 : 데이터는 송신 호스트에서 수신 호스트로만 전달
    - 전송 오류 없는 물리매체 : 통신 채널에서는 전송 오류가 발생하지 않음
  - 수신호스트 버퍼 개수가 제한된 경우 흐름제어 기능으로 송신 호스트의 전송 속도를 조절함
    - [송신 호스트의 전송속도] > [수신호스트의 수신속도] 인경우 , 수신호스트 버퍼 용량 부족으로 프레임 분실 가능
  - 흐름 제어는 주로 수신호스트가 송신 호스트의 정보 프레임 전송 시점을 제어하는 형태로 수행
  - 정지-대기 프로토콜1
    - ACK프레임의 역할
      - <small>송신 호스트에 긍정 응답의 기능을 수행하는 동시에 다음 프레임을 전송하도록 지시하는 흐름제어 기능도 수행</small>
    - 정지-대기(Stop-and-Wait)방식:
      - <small>수신 호스트가 회신하는 ACK프레임이 도착해야 다음 프레임을 전송할 수 있는 프로토콜 방식</small>
      - <small>전송효율이 매우 낮아, 일반 네트워크 환경에서는 사용하지 않음</small>

- ### 단방향 프로토콜 ( 오류제어 및 흐름제어 기능 있음)

  - 가정 :
    - <b>수신 호스트의 버퍼 개수가 유한함(버퍼 개수 제한</b>
    - <b>통신 채널에서 전송 오류가 발생할 수 있음</b>
      - <small><b>발생 가능한 오류: 프레임 변형 오류, 프레임 분실 오류 (수신자에게 프레임이 도작하지않고 사라짐)</b></small>
      - <small><b>정보 프레임 및 ACK/NAK프레임에 오류/ 손실이 발생할 수 있음</b></small>
    - 단방향 통신 :  데이터는 송신 호스트에서 수신 호스트로만 전달
  - 오류 제어와 흐름 제어가 모두 필요
  - 오류 제어
    - 프레임 변형 오류를 해결하기 위한 수신 호스트의 NAK 기능 필요 => 정보 프레임 재전송
    - 프레임 분실 오류를 해결하기 위한 송신 호스트의 타임아웃 기능 필요 => 정보 프레임 재전송
      - <small>일정 시간이 지날 때 까지 ACK/NAK를 회신 받지 못하면 수신 호스트는 프레임 분실이 발생한 것으로 간주</small>
  - NAK프레임이 정의되지 않은 경우 
    - 정보 프레임 변형 오류시 복구 방법 : ACK를 보내지 않음 => 송신호스트의 타임아웃 기능으로 오류 복구
    - 정보 프레임 분실 오류시 복구 방법 : ACK를 보내지 않음 => 송신호스트의 타임아웃 기능으로 오류 복구
  - NAK프레임이 정의되어 사용할 수 있는경우
    - 프레임 변형오류 : 수신 호스트의 NAK 프레임응답으로 오류 복구
    - 프레임 분실오류 : 송신 호스트의 타임아웃 기능으로 오류 복구

------

## 02_슬라이딩 윈도우 프로토콜

- ### 슬라이딩 윈도우 프로토콜

  - 양방향 통신을 지원 + 오류 제어와 흐름제어 기능을 모두 지원
  - 현재 대부분의 통신 프로토콜에서 슬라이딩 윈도우 프로토콜의 원리를 사용하고 있음
  - 기본절자
    1. 송신 호스트는 정보프레임을 순서 번호에 따라 순차적으로 전송함
    2. 정보 프레임을 수신한 수신호스트는..
       - <small>응답 프레임을 회신</small>
       - <small>이 때, ACK에 포함된 순서 번호는 정상적으로 수신한 번호가 아닌 다음에 수신하기를 기대하는 번호를 회신하는 것이 일반적이다. 따라서 ACK프레임에 기록된 순서 번호 이전 까지의 프레임은 모두 정상 수신했다는 의미가 된다.</small>
    3. 송신 호스트는 송신한 정보 프레임을 자신의 내부 버퍼에 유지해야하며, 이를 송신 윈도우라 한다. 송신 호스트의 송신 윈도우는 전송은 되었지만 긍정 응답이 회신되지 않은 프레임을 보관한다.
    4. 수신 호스트가 관리하는 수신 윈도우는 프로토콜의 방식에 따라 크기가 다르다.
       - <small>선택적 재전송 방식에서 수신 윈도우 크기는 송신 윈도우 크기와 같은 => 프레임의 도작이 비순서적으로 이루어져도 처리가 가능하다.</small>
       - <small>Go-Back-N방식에서는 크기가 1 => 이전에 수신한 프레임의 바로 다음 프레임만 처리함(순서에 어긋나서 도찯한 프레임은 버림)</small>

- ### 흐름제어

  - '슬라이딩 윈도우'는 윈도우의 이동을 의미하며 흐름 제어 기능의 핵심
  - 수신 호스트에게 연속적으로 보낼 수 있는 정보 프레임의 개수(=ACK없이 보낼 수 있는 정보 프레임의 수)를 윈도우의 크기로 지정하여 송신 호스트의 프레임 전송 속도를 제어
  - 순서 번호
    - 프레임 별로 부여되는 일련번호
      - <small>0 부터 임의의 최댓값 까지 순환 방식으로 사용</small>
      - <small>즉, 최대 값을 넘어서면 다시 0부터 시작</small>
    - 일반적로 순서 번호의 최댓값(+1)이 송신 윈도우 크기보다 커야함
      - <small>그래야 번호가 겹치는 경우가 발생하지 않음</small>
    - 정보 프레임 내용에는 순서번호를 저장하기 위한 공간이 확보 되어있음
      - <small>프레임에서 순서 번호의 공간 크기가 n비트이면, 순서 번호의 범위는 0 ~ 2<sup>n</sup>-1</small>
      - <small>정지-대기 방식의 프로토콜은 슬라이딩 윈도우 프로토콜에서 n=1인 특수한 경우에 해당</small>
  - 윈도우 크기
    - 송신 호스트로부터 긍정응답 프레임을 받지않고 전송할 수 있는 정보 프레임의 최대 갯수
    - 송신 호스트가 관리하는 송신 윈도우에는 수신 호스트에 전송되었으나 아직 ACK를 받지 못한 정보 프레임을 보관
      - <small>필요시 재전송을 하기 위해 보관</small>
      - <small>순서 번호를 기반으로 관리</small>
    - 슬라이딩 윈도우 프로토콜의 동작 과정(송신 윈도우 크기=3)
      - <small>전체 데이터를 10개의 정보 프레임으로 나눈 경우</small>

- ### 연속형 전송

  - 정지-대기 프로토콜은 송신 윈도우 크기가 1인경우와 동일하다

    - 하나의 정보 프레임 전송 후 해당 ACK를 받아야 다음 정보 프레임을 전송할 수있음
    - 전송 효율이 떨어짐

  - 연속형<sup>pipelining</sup>전송:ACK프레임을 받지 않고 여러 프레임을 연속 전송

    - 장점: 오류 가능성이 적은 환경에서 효율적
    - 전송한 정보 프레임에 오류가 발생하는 환경일  경우, 오류를 해결하는 방법에 따라 전송 효율이 영향을 받음

  - 오류 해결 방법

    - 선택적 재전송 : 오류가 발생한 프레임만 재전송
    - Go-Back-N : 오류가 발생한 프레임 이후의 모든 프레임을 재전송

  - Go-Back-N 방식

    - 상황 : 윈도우 크기 = 8, 송신 호스트는 10 ~ 17 번 정보 프레임 전송 => 12번 정보 프레임에 오류 발생
    - 오류가 발생한 12번 프레임을 포함 해 이후 전송된 모든 정보 프레임을 재전송
    - 단점 :
      - 순서에는 어긋났지만, 정상적으로 수신한 정보 프레임도 모두 재전송함

  - 선택적 재전송방식 : 오류가 발생한 프레임만 선턱적으로 복구하는 방식

    - NAK부정 응답 프레임을 사용해 오류가 발생한 정보 프레임을 복구(=재전송)

  - 연속형 전송 : GBN vs 선택적 재전송

    |      ---       |                             GBN                              |                        선택적 재전송                         |
    | :------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
    |      요약      |        손상/분실된 프레임 이후의 모든 프레임을 재전송        |                 손상/분실된 프레임만 재전송                  |
    | 수신 버퍼 크기 |             1<br />(순서에 어긋난 프레임은 버림)             |                    송신 버퍼와 크기 동일                     |
    |    전송효율    | 상대적으로 낮은 편<br>(정상적으로 수신된 프레임이라도 순서에 어긋나면 다시 전송) |     상대적으로 높은편<br>(오류가 발생한 프레임만 재전송)     |
    |  구현 복잡도   |                   구현이 상대적으로 쉬운편                   | 구현이 상대적으로 복잡한편<br>(순서에 어긋나게 도착한 프레임을 재정렬 등 추가 로직이 필요) |

  

- ### 피기 배킹<sup>Piggybacking</sup>

  - 정보 프레임을 전송하면서 응답 기능까지 함계 수행, 전송 효율을 높임( 양방향 통신 )
    - 수신자는 ACK를 보냄과 동시에 자신이 보내고 싶은 데이터를 붙여 보낸다.(ACK프레임을 별도로 보낼 필요가 없어 효율적이다)
    - 단 이경우가 만족되는경우는 서로서로 보낼 데이터가 있어야한다. 따라서 보낼 데이터가 없으면 ACK을 보내야 한다.

------

## 03_HDLC프로토콜

- ### HDLC<sup>High-level Data Link Control</sup>프로토콜

  - 일대일 혹은 일대 다로 연결된 환경에서 데이터의 송수신 기능 제공

- ### 용어

  - 서로 연결된 호스트를 주국<sup>Primary Station</sup>과 종국<sup>Secondary Station</sup>으로 구분
    - 혼합국<sup>Combined Station</sup> : 주국<sup>Primary Station</sup>과 종국<sup>Secondary Station</sup> 기능을 모두 지는 호스트
  - 명령<sup>Command</sup> : 주국<sup>Primary Station</sup>에서 전송되는 메세지
  - 응답<sup>Response</sup> : 종국<sup>Secondary Station</sup>의 회신

- ### 프레임 구조

  - HDLC 프레임 구조
    - 참고 
      - 상단의 숫자는 비트수
      - 프레임의 좌우에 위치한 01111110플래그는 프레임의 시작과 끝을 구분
    - Address (주소)
      - 일대다 환경에서 특정 호스트를 구분/지칭하는 목적으로 사용
      - 주국에서 정보 프레임 전송시, 수신 호스트인 종국 주소를 표기
      - 종국에서 전송 프레임 전송시, 본인의 주소를 표기
    - Control(제어):
      - 프레임의 종류를 구분
      - 프레임 유형에 따라 송신용 순서번호, 회신용 순서번호, 기타 제어 코드 등을 포함할 수있음
    - Data : 가변 크기의 전송데이터가 포함
    - Checksum : CRC-CCITT를 생성 다항식으로 하는 오류 검출 용도로 사용

- ### 프레임 종류

  - 프레임의 용도/종류는 Control필드 값에 따라 구분
  - 정보 프레임
    - 네트워크 게층이 요청한 데이터 전송용도
    - 3비트의 순서 번호를 이용한 슬라이딩 윈도우 프로토콜을 사용
    - Seq : 정보 프레임의 송신 용 순서번호로 사용
    - Next : 피키 배킹을 이용한 응답 기능으로 사용
    - P/F: 값이 1 인경우  Poll혹은 Final의 의미를 가짐
      - <small>주국의 명령 프레임에서 사용될 때는 Poll (command)</small>
      - <small>종국에서 주국으로 데이터를 전송할 때는 Final이라는 의미로 사용 (response)</small> 
  - 감독프레임
    - 정보 프레임에 대한 응답 기능을 수행하는프레임
    - 긍정 응답 프레임 과 부정 응답 프레임으로 구분
    - 프레임의 세부 종류는 Type필드 값에 따라 구분
  - 비번호 프레임 : 순서 번호가 없는 프레임을 정의
    - 주로 연결제어 등의 용도로 사용하며, 비연결형 데이터 전송을 위해 사용하기도함
    - 프레임의 종류 : Type과 Modifier필드를 합해 총 5비트로 프레임 종류를 구분

- ### LAP<sup>Link Access Protocol</sup> 프로토콜

  - LAP : 비동기 응답 모드인 ARM<sup>Asynchronous Response</sup>으로 동작하는 프로토콜
  - 연결과정
    - 주국에서 전송한 SARM명령에대해 종국에서  UA응답을 전송하여 연결설정
    - (LAP는 비동기 응답 모드로 동작하기 때문에) 종국에서 주국으로 SARM응답을 전송하여 연결 설정을 요구할 수 있음
      - <small>종국으로부터 SARM응답을 받은 주국은 SARM명령을 전송하고, 최종적으로 종국에서 UA응답을 전송함으로써 연결 설정이 완료된다.</small>
      - <small>이와 같이 종국에서 시작된 연결 설정은 3단계로 이루어지는 효과가 발생함</small>
  - 연결 해제 과정
    - 주극으로 부터 DISC명령이 발생하면 종국에서 UA응답을 전송하는 것으로 연결해제를 수행
    - 종국에서 DISC응답에 의한 연결해제를 수행하는 경우 3단계에 걸친 연결 해제 과정을 수행

- ### LAPB<sup>Link Access Protocol-Balanced</sup>프로토콜

  - 양쪽 호스트가 혼합 국으로 동작하기 때문에, 누구나 먼저 명령을 전송할 수 있음
  - 연결 설정
    - 비동기 균형 모드의 연결을 설정하기위해 우측 호스트가 좌측 호스트에 SABM명령을 전송한 경우, 왼쪽 호스트에서는 UA응답을 전송함으로써 계층2의 연결설정이 완료됨
  - 연결 해제
    - 임의의 호스트에서 DISC명령을 전송하고, 이를 수신한 측에서 UA응답을 하여 연결 해제가 수행됨